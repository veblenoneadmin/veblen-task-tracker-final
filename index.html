<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VEBLEN Task & Time Tracker</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/50CN8P5/fe71a9da-24a6-46cf-8eda-df73bff35fc8.png">
    <link rel="apple-touch-icon" href="https://i.ibb.co/50CN8P5/fe71a9da-24a6-46cf-8eda-df73bff35fc8.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>
                <img src="https://i.ibb.co/50CN8P5/fe71a9da-24a6-46cf-8eda-df73bff35fc8.png" alt="VEBLEN" class="logo"> 
                Task & Time Tracker
            </h1>
            <div class="employee-selector">
                <label for="employeeSelect">Employee:</label>
                <select id="employeeSelect">
                    <option value="">Select Employee</option>
                    <option value="Tony Herrera">Tony Herrera</option>
                    <option value="Alex">Alex</option>
                    <option value="Ridho">Ridho</option>
                    <option value="Jevahn">Jevahn</option>
                    <option value="Risna">Risna</option>
                    <option value="Pran Setiawan">Pran Setiawan</option>
                    <option value="Wayan Arfian (Konsep Kreatif)">Wayan Arfian (Konsep Kreatif)</option>
                    <option value="Hanif (Konsep Kreatif)">Hanif (Konsep Kreatif)</option>
                    <option value="Eden">Eden</option>
                    <option value="Social Media Manager">Social Media Manager</option>
                    <option value="Zac Macanally">Zac Macanally</option>
                </select>
            </div>
        </header>

        <!-- Brisbane Clock Section - Inserted by JavaScript -->
        <!-- The Brisbane clock will be dynamically inserted here by script.js -->

        <!-- Time Clock Section -->
        <section class="time-clock-section">
            <h2>üïê Time Clock</h2>
            
            <!-- Real-time Work Clock Display -->
            <div id="workClockDisplay" class="work-clock-display" style="display: none;">
                <div class="clock-info">
                    <h3>Currently Working</h3>
                    <div class="work-timer" id="workTimer">00:00:00</div>
                    <div class="shift-progress">
                        <div class="shift-info">
                            <span class="shift-label">Total Shift Time</span>
                            <span class="shift-time" id="totalShiftTime">00:00:00</span>
                        </div>
                        <div class="shift-bar-container">
                            <div class="shift-bar" id="shiftProgressBar"></div>
                        </div>
                        <div class="shift-target">
                            <span id="shiftStatus">0% of 8 hours completed</span>
                        </div>
                    </div>
                    <p class="work-status" id="workStatus">Started work at --:--</p>
                </div>
            </div>

            <!-- Break Clock Display -->
            <div id="breakClockDisplay" class="break-clock-display" style="display: none;">
                <div class="clock-info">
                    <h3>On Break</h3>
                    <div class="break-timer" id="breakTimer">00:00:00</div>
                    <div class="break-info">
                        <p class="total-worked">Total worked today: <span id="totalWorkedOnBreak">00:00:00</span></p>
                        <p class="shift-remaining">Remaining: <span id="shiftRemainingOnBreak">08:00:00</span></p>
                    </div>
                    <p class="break-status" id="breakStatus">Started break at --:--</p>
                </div>
            </div>
            
            <!-- Time Clock Buttons -->
            <div class="time-clock-buttons">
                <button id="startWorkBtn" class="btn btn-success">üü¢ START WORK</button>
                <button id="breakBtn" class="btn btn-warning">‚òï BREAK</button>
                <button id="backToWorkBtn" class="btn btn-info">üîµ BACK TO WORK</button>
                <button id="endWorkBtn" class="btn btn-danger">üî¥ END WORK</button>
            </div>
            
            <!-- Time Clock Status -->
            <div id="timeClockStatus" class="time-clock-status">Ready to start your shift</div>
        </section>

        <!-- Active Task Display Section -->
        <section class="active-task-section" id="activeTaskSection" style="display: none;">
            <h2>üéØ Currently Working On</h2>
            <div id="activeTaskInfo">
                <!-- Active task info will be populated here by JavaScript -->
            </div>
        </section>

        <!-- Task Intake Section -->
        <section class="task-intake-section">
            <h2>üìù Create New Task</h2>
            <form id="taskIntakeForm">
                <!-- Company Selection -->
                <div class="form-group">
                    <label for="taskCompany">Company* <span style="color: #f56565;">‚óè</span></label>
                    <select id="taskCompany" name="taskCompany" required>
                        <option value="">Select Company</option>
                        <option value="VEBLEN (Internal)">VEBLEN (Internal)</option>
                        <option value="LCMB GROUP">LCMB GROUP</option>
                        <option value="NEWTECH TRAILERS">NEWTECH TRAILERS</option>
                        <option value="CROWN REALITY">CROWN REALITY</option>
                        <option value="FLECK GROUP">FLECK GROUP</option>
                    </select>
                </div>

                <!-- Priority -->
                <div class="form-group">
                    <label for="taskPriority">Is this project a priority?* <span style="color: #f56565;">‚óè</span></label>
                    <select id="taskPriority" name="taskPriority" required>
                        <option value="">Select Priority</option>
                        <option value="No">üü¢ No</option>
                        <option value="Yes">üî¥ Yes</option>
                    </select>
                </div>

                <!-- Task Name -->
                <div class="form-group">
                    <label for="taskTitle">Project Title* <span style="color: #f56565;">‚óè</span></label>
                    <input type="text" id="taskTitle" name="taskTitle" required placeholder="Enter project title">
                </div>

                <!-- Description -->
                <div class="form-group">
                    <label for="taskDescription">Description* <span style="color: #f56565;">‚óè</span></label>
                    <textarea id="taskDescription" name="taskDescription" rows="4" required placeholder="Describe the task in detail"></textarea>
                </div>

                <!-- Due Date -->
                <div class="form-group">
                    <label for="taskDueDate">Due Date* <span style="color: #f56565;">‚óè</span></label>
                    <input type="date" id="taskDueDate" name="taskDueDate" required>
                </div>

                <!-- Assigned To -->
                <div class="form-group">
                    <label for="taskAssigned">Assigned To* (Hold Ctrl/Cmd for multiple) <span style="color: #f56565;">‚óè</span></label>
                    <select id="taskAssigned" name="taskAssigned" multiple required>
                        <option value="Tony Herrera">Tony Herrera</option>
                        <option value="Alex">Alex</option>
                        <option value="Eden">Eden</option>
                        <option value="Social Media Manager">Social Media Manager</option>
                        <option value="Ridho">Ridho</option>
                        <option value="Risna">Risna</option>
                        <option value="Pran Setiawan">Pran Setiawan</option>
                        <option value="Wayan Arfian (Konsep Kreatif)">Wayan Arfian</option>
                        <option value="Hanif (Konsep Kreatif)">Hanif</option>
                        <option value="Jevahn">Jevahn</option>
                        <option value="Zac Macanally">Zac Macanally</option>
                    </select>
                </div>

                <!-- Image Upload -->
                <div class="form-group">
                    <label for="taskImage">Attach Image* <span style="color: #f56565;">‚óè</span></label>
                    <input type="file" id="taskImage" name="taskImage" accept=".jpg,.jpeg,.png,.gif,.bmp,.webp" required>
                    <small style="color: var(--text-secondary); font-size: 0.75rem; display: block; margin-top: 0.5rem;">
                        üì∏ Accepted: JPEG, PNG, GIF, BMP, WebP (max 32MB)
                    </small>
                    <div id="taskImagePreview" style="display: none;"></div>
                </div>

                <!-- Links -->
                <div class="form-group">
                    <label for="taskLinks">Links (optional)</label>
                    <textarea id="taskLinks" name="taskLinks" rows="3" placeholder="Add any relevant links (one per line)"></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary">‚ú® Create Task</button>
            </form>
        </section>

        <!-- Assigned Tasks Section -->
        <section class="assigned-tasks-section">
            <h2>üìã My Imported Tasks
                <button id="openTaskEditorBtn" class="btn btn-primary btn-sm" style="margin-left: 1rem;" onclick="openTaskEditorModal()">üì• Import Task from Infinity</button>
            </h2>
            <button id="refreshTasksBtn" class="btn btn-secondary">üîÑ Refresh Dashboard</button>
            <div id="assignedTasksList" class="assigned-tasks-list">
                <p class="loading">Select an employee to view your imported tasks...</p>
            </div>
        </section>

        <!-- Daily Report Section -->
        <section class="daily-report-section">
            <h2>üìä Daily Report</h2>
            <form id="dailyReportForm">
                <!-- Photo Upload -->
                <div class="form-group">
                    <label for="reportPhoto">Photo for Report* <span style="color: #f56565;">‚óè</span></label>
                    <input type="file" id="reportPhoto" name="reportPhoto" accept=".jpg,.jpeg,.png,.gif,.bmp,.webp" required>
                    <small style="color: var(--text-secondary); font-size: 0.75rem; display: block; margin-top: 0.5rem;">
                        üì∏ Accepted: JPEG, PNG, GIF, BMP, WebP (max 32MB)
                    </small>
                    <div id="reportPhotoPreview" style="display: none;"></div>
                </div>
                
                <!-- Company Selection -->
                <div class="form-group">
                    <label for="reportCompany">Company* <span style="color: #f56565;">‚óè</span></label>
                    <select id="reportCompany" name="reportCompany" required>
                        <option value="">Select Company</option>
                        <option value="VEBLEN (Internal)">VEBLEN (Internal)</option>
                        <option value="LCMB GROUP">LCMB GROUP</option>
                        <option value="NEWTECH TRAILERS">NEWTECH TRAILERS</option>
                        <option value="CROWN REALITY">CROWN REALITY</option>
                        <option value="FLECK GROUP">FLECK GROUP</option>
                    </select>
                </div>
                
                <!-- Date -->
                <div class="form-group">
                    <label for="reportDate">Date* <span style="color: #f56565;">‚óè</span></label>
                    <input type="date" id="reportDate" name="reportDate" required>
                </div>
                
                <!-- Project Name -->
                <div class="form-group">
                    <label for="projectName">Project Name* <span style="color: #f56565;">‚óè</span></label>
                    <input type="text" id="projectName" name="projectName" placeholder="Enter the project name" required>
                </div>
                
                <!-- Number of Revisions -->
                <div class="form-group">
                    <label for="numRevisions">Number of Revisions* <span style="color: #f56565;">‚óè</span></label>
                    <input type="number" id="numRevisions" name="numRevisions" placeholder="Number of Revisions" min="0" required>
                </div>
                
                <!-- Total Time Spent -->
                <div class="form-group">
                    <label for="totalTimeSpent">Total Time Spent on Project* <span style="color: #f56565;">‚óè</span></label>
                    <input type="text" id="totalTimeSpent" name="totalTimeSpent" placeholder="e.g., 3 hours" required>
                </div>
                
                <!-- Notes -->
                <div class="form-group">
                    <label for="reportNotes">Notes* <span style="color: #f56565;">‚óè</span></label>
                    <textarea id="reportNotes" name="reportNotes" rows="4" placeholder="Notes" required></textarea>
                </div>
                
                <!-- Links -->
                <div class="form-group">
                    <label for="reportLinks">Links (optional)</label>
                    <textarea id="reportLinks" name="reportLinks" rows="3" placeholder="Add any relevant links (one per line)"></textarea>
                </div>
                
                <!-- Feedback or Requests -->
                <div class="form-group">
                    <label for="feedbackRequests">Feedback or Requests (optional)</label>
                    <textarea id="feedbackRequests" name="feedbackRequests" rows="5" placeholder="Any feedback, requests, or suggestions? e.g.:&#10;&#10;‚Ä¢ Can we use a simpler tool instead of X?&#10;‚Ä¢ I'm having trouble with Y software&#10;‚Ä¢ Can we add Z feature to our workflow?&#10;‚Ä¢ The current process for A is confusing&#10;&#10;(Leave blank if no feedback)"></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary">üì§ Submit Report</button>
            </form>
        </section>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Load JavaScript -->
    <script src="script.js"></script>
    
    <!-- Error Handling and Health Check -->
    <script>
        // Add error boundary
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            // Show user-friendly error message
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = 'Connection error. Please refresh the page.';
            errorDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #ff4444; color: white; padding: 10px 20px; border-radius: 5px; z-index: 9999;';
            document.body.appendChild(errorDiv);
            setTimeout(() => errorDiv.remove(), 5000);
        });

        // Check API health on load
        fetch('/api/health')
            .then(res => res.json())
            .then(data => console.log('API Health:', data))
            .catch(err => console.error('API not responding:', err));
    </script>
</body>
</html>
